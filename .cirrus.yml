env:
    CIRRUS_CLONE_DEPTH: 1
    CIRRUS_WORKING_DIR: "/tmp/ci"
    rclone_config: "ENCRYPTED[e0081039bb715c7a2d70240967dd7e361acd4b377511d9ec3158cbe0f9078bb8ea3d56029c3f737615966cdaa97a142d]"
    TOKEN: "ENCRYPTED[adfb162a64eb8267f92771edea5e4db57d01360b71049f94b33aa4af892042d9e228a0a3d6d85aabd1f64d4ac0ab995b]"
    CHATID: "ENCRYPTED[9122236190b50c7cfa962cf071053baeb4500a6cfa070db7995b426efd0959b846363b7f2c67063fa08660a77073a3e2]"
    BOTTOKEN: "ENCRYPTED[697b0e148de1c5d198ccdd353bb32ad92f99828e5443e7ad514e3926c027d5d42e22f8faa73e3ba44b0c2021f891bce9]"
    
task:
  container:
    image: geopd/builder:update
    cpu: 16
    memory: 24G

  name: rom
  timeout_in: 120m
  download_ccache_background_script:
      - cd /tmp && mkdir -p ~/.config/rclone
      - echo "$rclone_config" > ~/.config/rclone/rclone.conf
      - rclone copy AleX:/rom/ccache/ccache.tar.gz /tmp -P && tar xf ccache.tar.gz
  build_script:
      - bash build.sh
    
  upload_ccache_script:
      - cd /tmp && tar --use-compress-program="pigz -k -1 " -cf ccache.tar.gz ccache
      - rclone copy ccache.tar.gz AleX:/rom/ccache -P
